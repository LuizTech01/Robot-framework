trigger:
  - dev

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'

  - script: |
      sudo apt update
      sudo apt install -y wget unzip xvfb libxi6 libgconf-2-4
      wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
      sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt -f install -y
      CHROME_VERSION=$(google-chrome --version | grep -oP '\d+\.\d+\.\d+')
      DRIVER_VERSION=$(curl -s "https://googlechromelabs.github.io/chrome-for-testing/last-known-good-versions-with-downloads.json" | jq -r ".channels.Stable.version")
      wget "https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/${DRIVER_VERSION}/linux64/chromedriver-linux64.zip"
      unzip chromedriver-linux64.zip
      sudo mv chromedriver-linux64/chromedriver /usr/local/bin/
      sudo chmod +x /usr/local/bin/chromedriver
    displayName: 'Instalar Chrome e ChromeDriver'

  - script: |
      pip install -U pip
      pip install robotframework robotframework-seleniumlibrary
    displayName: 'Instalar dependÃªncias Python'

  - script: |
      xvfb-run robot -d results tests/
    displayName: 'Executar testes com Xvfb'

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: results
      artifactName: TestResults
    displayName: 'Publicar Resultados dos Testes'
